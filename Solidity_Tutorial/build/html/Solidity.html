<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction to Solidity &mdash; Solidity Tutorial 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Solidity Tutorial
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Introduction to Solidity</a><ul>
<li><a class="reference internal" href="#what-is-solidity">What is Solidity ?</a></li>
<li><a class="reference internal" href="#quick-intro-to-coding-with-solidity">Quick intro to coding with solidity</a><ul>
<li><a class="reference internal" href="#basic-variable-types">Basic Variable types</a></li>
<li><a class="reference internal" href="#using-functions">Using Functions</a></li>
<li><a class="reference internal" href="#using-structs">Using Structs</a></li>
<li><a class="reference internal" href="#using-arrays">Using Arrays</a></li>
<li><a class="reference internal" href="#using-mappings">Using mappings</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storage-factory-example">Storage Factory Example</a><ul>
<li><a class="reference internal" href="#implemeting-the-storage-factory">Implemeting the storage factory</a></li>
<li><a class="reference internal" href="#inheritance">Inheritance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fund-me">Fund Me</a><ul>
<li><a class="reference internal" href="#a-simple-function-to-fund-your-smart-contract">A simple function to fund your smart contract</a></li>
<li><a class="reference internal" href="#getting-external-data-with-chainlink">Getting external data with chainlink</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-interfaces">Working with interfaces</a></li>
<li><a class="reference internal" href="#matching-units">Matching units</a></li>
<li><a class="reference internal" href="#thresholding">Thresholding</a></li>
<li><a class="reference internal" href="#ownership">Ownership</a></li>
<li><a class="reference internal" href="#modifiers-and-resetting">Modifiers and resetting</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Solidity Tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Introduction to Solidity</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Solidity.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction-to-solidity">
<h1>Introduction to Solidity<a class="headerlink" href="#introduction-to-solidity" title="Permalink to this headline"></a></h1>
<section id="what-is-solidity">
<h2>What is Solidity ?<a class="headerlink" href="#what-is-solidity" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Solidity is an object-oriented, high-level language for implementing smart contracts. Smart contracts are programs which govern the behaviour of accounts within the Ethereum state.</p></li>
</ul>
</section>
<section id="quick-intro-to-coding-with-solidity">
<h2>Quick intro to coding with solidity<a class="headerlink" href="#quick-intro-to-coding-with-solidity" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><strong>This will be a quick intro to coding with solidity before we jump to more complicated things</strong>.</p></li>
<li><p>A program in solidity always begins with <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">solidity</span></code> and then the version of solidity we’re going to use.</p></li>
</ul>
<ul>
<li><p>Example:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">solidity</span> <span class="pre">&gt;=0.6.0</span> <span class="pre">&lt;0.9.0</span></code>; to say that the solidity version we are using is a version between 0.6.0 and 0.9.0 so we can use any compiler in this range.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">solidity</span> <span class="pre">^0.6</span></code>; to say that we are using any 0.6 version (0.6.0 –&gt; 0.7.0)</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<ul class="simple">
<li><p>The fundamental entity in any solidity program is the <cite>contract</cite>. It is somehow similar to a class in any object-oriented programming language.</p></li>
<li><p>Any solidity statement is ended by semi-column (;)</p></li>
</ul>
<ul class="simple">
<li><p>Complete example</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// This is a comment</span>

<span class="k">contract</span><span class="w"> </span><span class="ni">First_Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="basic-variable-types">
<h3>Basic Variable types<a class="headerlink" href="#basic-variable-types" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>In solidity, the basic variable types that are very common to any programming language are: <code class="docutils literal notranslate"><span class="pre">uint</span></code> <code class="docutils literal notranslate"><span class="pre">int</span></code> <code class="docutils literal notranslate"><span class="pre">bool</span></code> <code class="docutils literal notranslate"><span class="pre">string</span></code></p></li>
<li><dl class="simple">
<dt>There are other types that are specific to solidity like:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">address</span></code>: An Ethereum Wallet adress for example</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytes32</span></code>: any value passed here will be converted to bytes with 32 bits (Max allowed is 32 bits… we also have <code class="docutils literal notranslate"><span class="pre">bytesN</span></code> with N can be any number below 32)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Complete example</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>


<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">favoriteNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"> </span><span class="c1">// integer of size 256 bits which is the most commonly used</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">favoriteBool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w">   </span><span class="c1">// boolean</span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">favString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;String&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">int256</span><span class="w"> </span><span class="nv">favInt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m m-Decimal">5</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">favAdress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x44Ee91Bded46d0B5B13845124ca949F4f048Ed64</span><span class="p">;</span><span class="w"> </span><span class="c1">// My testNet Ethereum wallet address</span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">favBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cat&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// It will be stored as bytes32</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If we don’t initialize our variables, they get automatically initialized to their corresponding null value (0 for integers for example).</p></li>
<li><dl class="simple">
<dt>If we want our variable to be visualized outside of the code, we can use the keyword <code class="docutils literal notranslate"><span class="pre">public</span></code>:</dt><dd><ul>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">uint256</span> <span class="pre">public</span> <span class="pre">Nbr</span> <span class="pre">=</span> <span class="pre">5;</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</section>
<section id="using-functions">
<h3>Using Functions<a class="headerlink" href="#using-functions" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>We will start this section by giving two examples. We will create a function that stores a number inside a <code class="docutils literal notranslate"><span class="pre">uint256</span></code> variable and hence changing its value, and another that retrieves it.</p></li>
<li><p>In <strong>Solidity</strong>, a function is created using the keyword <code class="docutils literal notranslate"><span class="pre">function</span></code>. This function can be either <em>public</em>, <em>private</em> or other types that we’ll talk about later.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">favNumber</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// We will store a new &quot;uint256&quot; inside of a previously created variable called favNumber</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">store</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_newNumber</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>favNumber<span class="w"> </span><span class="o">=</span><span class="w"> </span>_newNumber<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Since favNumber has been created in the contract, it has it’s scope and can hence be used anywhere in the code. Otherwise, if a variable is defined inside of a function, it has the scope of that particular function and cannot be used outside of it.</p></li>
</ul>
</div>
<ul class="simple">
<li><dl class="simple">
<dt>Now we will complete our code with a <code class="docutils literal notranslate"><span class="pre">function</span></code> that retireves the updated number and renders it.</dt><dd><ul>
<li><p>This function needs to <strong>return</strong> something and that is why we will use the keyword <code class="docutils literal notranslate"><span class="pre">returns</span></code>.</p></li>
<li><p>There is 2 keywords in solidity that define functions and overwhich we don’t have to make a transaction and these keywords are <code class="docutils literal notranslate"><span class="pre">view</span></code> and <code class="docutils literal notranslate"><span class="pre">pure</span></code>.</p></li>
<li><p>We use <code class="docutils literal notranslate"><span class="pre">view</span></code> keyword when we want to read a state of the blockchain (A public variable is hence also a <code class="docutils literal notranslate"><span class="pre">view</span></code> function)</p></li>
<li><p>We use <code class="docutils literal notranslate"><span class="pre">pure</span></code> keyword when we want to perform pure maths whitout saving any particular state.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">favNumber</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">store</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_newNumber</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>favNumber<span class="w"> </span><span class="o">=</span><span class="w"> </span>_newNumber<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">retrieve</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span>favNumber<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="using-structs">
<h3>Using Structs<a class="headerlink" href="#using-structs" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">structs</span></code> are used to create new structures (or types or data types …) in <strong>solidity</strong>.</p></li>
<li><p>Suppose we want to create a <code class="docutils literal notranslate"><span class="pre">structure</span></code> called <strong>People</strong> where we store any persons’s name and age. The example below illustrated how we can do this.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="kt">uint256</span><span class="w"> </span><span class="nv">dummy_number</span><span class="p">;</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">People</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w"> </span><span class="c1">// First index in the People struct</span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">age</span><span class="p">;</span><span class="w"> </span><span class="c1">// Second index in the People struct</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Now we can create a new variable using the &quot;datatype&quot; or the structure we created</span>
People<span class="w"> </span><span class="kt">public</span><span class="w"> </span>person<span class="w"> </span><span class="o">=</span><span class="w"> </span>People<span class="p">({</span>name<span class="p">:</span><span class="s2">&quot;Chaimae Baraki&quot;</span><span class="p">,</span><span class="w"> </span>age<span class="p">:</span><span class="m m-Decimal">25</span><span class="p">})</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><dl class="simple">
<dt><strong>Solidity</strong> indexes its variables wrt to the order of their appearance in the code and their scope.</dt><dd><ul>
<li><p><cite>dummy_number</cite> in the previous code snippet for example has index 0</p></li>
<li><p>name and age have respectively indices 0 and 1 in their <cite>People</cite> structure</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</section>
<section id="using-arrays">
<h3>Using Arrays<a class="headerlink" href="#using-arrays" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>When we used the People <code class="docutils literal notranslate"><span class="pre">struct</span></code> as an example, we were able to create a <em>person</em> type that contains the name and the age of a given person but nothing more. That is, if we want to create for example, a list of people, we cannot do it using <code class="docutils literal notranslate"><span class="pre">struct</span></code>. This is where the <code class="docutils literal notranslate"><span class="pre">array</span></code> type comes into place. An <code class="docutils literal notranslate"><span class="pre">array</span></code> is created using a <code class="docutils literal notranslate"><span class="pre">struct</span></code>. In the example below we will create an array <strong>people</strong> that can contain any number of persons inside it.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">People</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">age</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

People<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>people<span class="p">;</span><span class="w"> </span><span class="c1">// Creating a public array called people</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>What we want to do now is filling this array. For this we will create a <code class="docutils literal notranslate"><span class="pre">function</span></code> <strong>addPerson</strong> and <code class="docutils literal notranslate"><span class="pre">push</span></code> the created <strong>person</strong> to the array inside it.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="kt">struct</span><span class="w"> </span><span class="nv">People</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">age</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

People<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>people<span class="p">;</span><span class="w"></span>

<span class="kt">function</span><span class="w"> </span><span class="nv">addPerson</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_age</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>people<span class="p">.</span>push<span class="p">(</span>People<span class="p">({</span>name<span class="p">:</span>_name<span class="p">,</span><span class="w"> </span>age<span class="p">:</span>_age<span class="p">}));</span><span class="w"></span>
<span class="w">        </span><span class="c1">// or people.push(People({name:_name, age:_age})); (by index)</span>
<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When we crate an array using empty [ ], the array can have any size and contain any number of entries –&gt; <strong>It is dynamic</strong></p></li>
<li><p>If we want an array to contain only <strong>N</strong> entries we simply pass <strong>N</strong> to the array: People[N] = A people array with no more than 2 entries (a size 2 array).</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">memory</span></code> keyword: In solidity, there is 2 ways to store information, we can store it in memory or in storage; When we store an object in memory, this means that it will only be stored during execution of the function. If we hold the object in storage, that piece of data will persist even after the function executes. A string in solidity is actually an object, <strong>it is an array of bytes</strong> and hence we have to decide whether to store it in memory or in storage. Since we need the string “_name” only during the function execution, we can have it stored in memory and when it is passed to the People array, we are guaranteed that it will be stored there forever (and hence in storage). To summarize;</dt><dd><ul>
<li><p>memory = delete the variable after exectuion</p></li>
<li><p>storage =  keep it forever.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</section>
<section id="using-mappings">
<h3>Using mappings<a class="headerlink" href="#using-mappings" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>In the previous code snippet, we’ve created an array that can contain any number of people (dynamic array) stored by their name and age. But what if we want to know for example the age of a person given its name ? This is possible through another datastrucuture called <strong>mappings</strong>.</p></li>
<li><p>Mappings are dictionnary like datastructures that are used to map an object to another object or value.</p></li>
<li><p>In the code snippet below, we will create a dynamic People array, and a mapping of the age of each person by its name:</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">struct</span><span class="w"> </span><span class="nv">People</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">age</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span>People<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>people<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="c1">// We create a mapping of the name to the age:</span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>nameToAge<span class="p">;</span><span class="w"></span>


<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">addPerson</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_age</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>people<span class="p">.</span>push<span class="p">(</span>People<span class="p">({</span>name<span class="p">:</span>_name<span class="p">,</span><span class="w"> </span>age<span class="p">:</span>_age<span class="p">}));</span><span class="w"></span>
<span class="w">                </span>nameToAge<span class="p">[</span>_name<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_age<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>- SPDX licence identifier</strong>: Trust in smart contract can be better established if their source code is available. Since making source code available always touches on legal problems with regards to copyright, the Solidity compiler encouranges the use of machine-readable SPDX license identifiers. Every source file should start with a comment indicating its license: <strong>// SPDX-License-Identifier: MIT</strong> (It means that, <em>Hey, everybody can use this code and, we don’t care</em>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>When working with <strong>REMIX IDE</strong>, we developp smart contracts using the javascript VM. This way, we are provided with 100 ETH test tokens for testing and deployment and so on. If we want to deploy our smart contracts to let others interact with it, then, in remix, we switch to injected web3. This way, Metamask will popup asking for authorization to use either the testnet (Rinkeby faucet for example) or the mainnet (The real account). Injected WEB3 actually means that we are taking metamask and injecting it into the source code of the browser. This means that our WEB3 provider is metamask in this case. If we want to use another web3 provider than, there is another option to do so in REMIX.</p></li>
</ul>
</div>
</section>
</section>
<section id="storage-factory-example">
<h2>Storage Factory Example<a class="headerlink" href="#storage-factory-example" title="Permalink to this headline"></a></h2>
<section id="implemeting-the-storage-factory">
<h3>Implemeting the storage factory<a class="headerlink" href="#implemeting-the-storage-factory" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Let’s say now that we want to execute a contract from another contract that is written in another file. For this we use import. To illustrate this, we’re gonna create a simple storage smart contract to store people by name and age and map their names to their ages and then create another contract that executes this contract.</p></li>
</ul>
<ul class="simple">
<li><p>Simple storage contract</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">SimpleStorage</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="c1">// We will define two functions for later use</span>
<span class="w">        </span><span class="c1">// one to store a number and one to retrieve it</span>

<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">favNumber</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">store</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_number</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>favNumber<span class="w"> </span><span class="o">=</span><span class="w"> </span>_number<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">retrieve</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span>favNumber<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">struct</span><span class="w"> </span><span class="nv">People</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">string</span><span class="w"> </span><span class="nv">name</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="kt">uint</span><span class="w"> </span><span class="nv">age</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span>People<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>people<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>nameToAge<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">addPerson</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="w"> </span>_name<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_age</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>people<span class="p">.</span>push<span class="p">(</span>People<span class="p">({</span>name<span class="p">:</span>_name<span class="p">,</span><span class="w"> </span>age<span class="p">:</span>_age<span class="p">}));</span><span class="w"></span>
<span class="w">                </span>nameToAge<span class="p">[</span>_name<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_age<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>This smart contract is saved to a file called SimpleStorage.sol</p></li>
<li><p>Now we’re gonna create another smart contract. In this smart contract, we’re gonna simply import our SimpleStorage smart contract.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./SimpleStorage.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">StorageFactory</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>This way, we can see in REMIX that we can either deploy the imported smart contract (SimpleStorage) or the empty one (StorageFactory).</p></li>
<li><p>What we wanna do is deploying the SimpleStorage smart contract from the StorageFactory smart contract. Hence, we have to create a function for that.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./SimpleStorage.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">StorageFactory</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">createSimpleStorageContract</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// We define a new variable of type SimpleStorage contract with a name (for example simpleStorage):</span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>SimpleStorage<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Using these few lines of code, we are able to deploy a smart contract from another smart contract. The only remaining issue is that, using REMIX IDE for example with a javascript VM will show us that the contracts have been created and deployed but we can’t really read where those contracts are being created (Unlike if we we’re using a real network or a testnet, in this case, we can see our contracts on etherscan). To keep track of the SimpleStorage contract that we’ve deployed, we can use an array..</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">//SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.6.0</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./SimpleStorage.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">StorageFactory</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="c1">// To keep track of created contracts</span>
<span class="w">        </span><span class="c1">// using REMIX IDE VM</span>
<span class="w">        </span>SimpleStorage<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>simpleStorageArray<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">createSimpleStorageContract</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// We define a new variable of type SimpleStorage contract with a name (for example simpleStorage):</span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>SimpleStorage<span class="p">();</span><span class="w"></span>

<span class="w">                </span><span class="c1">// To keep track of created contracts</span>
<span class="w">                </span><span class="c1">// using REMIX IDE VM</span>
<span class="w">                </span>simpleStorageArray<span class="p">.</span>push<span class="p">(</span>simpleStorage<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>If we run this code snippet in a REMIX IDE with a JavaScript VM environement for example, we’re gonna get for each smart contract created by the <cite>createSimpleStorageContract</cite> an adress that the corresponding contract was deployed to. This way, we deployed a contract to the blockchain from another contract.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>We should always think of starting our code with a license identifier : <strong>SPDX-License-Identifier: MIT</strong></p></li>
</ul>
</div>
<ul class="simple">
<li><p>What we want to do in the next step is to call the function that are defined in the internal contract from the new contract. To achieve this, we have to create functions in our new contract to call other functions that are originally defined in the contract deployed contract.</p></li>
</ul>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<ul class="simple">
<li><p>To interact with a contract, we need two things; the adress of the contract we want to interact with and the ABI (Application Binary Interface).</p></li>
<li><p>Since we are storing our deployed contracts in an array, each contract can be pointed to by its index in the array and we can interact with it through its adress.</p></li>
</ul>
</div>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>

<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./SimpleStorage.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">StorageFactory</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>SimpleStorage<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>simpleStorageArray<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">createSimpleStorageContract</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>SimpleStorage<span class="p">();</span><span class="w"></span>
<span class="w">                </span>simpleStorageArray<span class="p">.</span>push<span class="p">(</span>simpleStorage<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Function to call Store function of SimpleStorage</span>
<span class="w">        </span><span class="c1">// we need to pass an index to point to a deployed contract in</span>
<span class="w">        </span><span class="c1">// the array where all deployed contracts are (simpleStorageArray)</span>
<span class="w">        </span><span class="c1">// We will also pass a number to be stored as required by</span>
<span class="w">        </span><span class="c1">// the SimpleStorage store function</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">sfStore</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_simpleStorageIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_simpleStorageNumber</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// We can get the adress of a contract through the</span>
<span class="w">                </span><span class="c1">// function adress(your_contract)</span>
<span class="w">                </span><span class="c1">// We create simpleStorage object that we can use to</span>
<span class="w">                </span><span class="c1">// call any function in the SimpleStorage contract</span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SimpleStorage<span class="p">(</span><span class="kt">address</span><span class="p">(</span>simpleStorageArray<span class="p">[</span>_simpleStorageIndex<span class="p">]));</span><span class="w"></span>
<span class="w">                </span>simpleStorage<span class="p">.</span>store<span class="p">(</span>_simpleStorageNumber<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">sfRetrieve</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_simpleStorageIndex</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SimpleStorage<span class="p">(</span><span class="kt">address</span><span class="p">(</span>simpleStorageArray<span class="p">[</span>_simpleStorageIndex<span class="p">]));</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span>simpleStorage<span class="p">.</span>retrieve<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="inheritance">
<h3>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>So far, all looks good, but what if we had too many functions inside SimpleStorage contract and we wanted to use all of them inside our StorageFactory ?</p></li>
<li><p>Inheritance solves this problem: StorageFactory can inherit all the functions of SimpleStorage.</p></li>
<li><p>In solidity, we simply define our StorageFactory to be of “contract” SimpleStorage. (similar to saying of “type” or of “class” in any other programming language). To do so, we use <strong>is</strong> <code class="docutils literal notranslate"><span class="pre">contract</span> <span class="pre">StorageFactory</span> <span class="pre">is</span> <span class="pre">SimpleStorage</span> <span class="pre">{</span> <span class="pre">//</span> <span class="pre">lines-of-code;</span> <span class="pre">}</span></code>. This is enough to have all the functions that are defined in SimpleStorage imported in the StorageFactory and ready to be used.</p></li>
<li><p>The code becomes;</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>

<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;./SimpleStorage.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">StorageFactory</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>SimpleStorage<span class="p">{</span><span class="w"></span>

<span class="w">        </span>SimpleStorage<span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>simpleStorageArray<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">createSimpleStorageContract</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span>SimpleStorage<span class="p">();</span><span class="w"></span>
<span class="w">                </span>simpleStorageArray<span class="p">.</span>push<span class="p">(</span>simpleStorage<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Function to call Store function of SimpleStorage</span>
<span class="w">        </span><span class="c1">// we need to pass an index to point to a deployed contract in</span>
<span class="w">        </span><span class="c1">// the array where all deployed contracts are (simpleStorageArray)</span>
<span class="w">        </span><span class="c1">// We will also pass a number to be stored as required by</span>
<span class="w">        </span><span class="c1">// the SimpleStorage store function</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">sfStore</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_simpleStorageIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_simpleStorageNumber</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// We can get the adress of a contract through the</span>
<span class="w">                </span><span class="c1">// function adress(your_contract)</span>
<span class="w">                </span><span class="c1">// We create simpleStorage object that we can use to</span>
<span class="w">                </span><span class="c1">// call any function in the SimpleStorage contract</span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SimpleStorage<span class="p">(</span><span class="kt">address</span><span class="p">(</span>simpleStorageArray<span class="p">[</span>_simpleStorageIndex<span class="p">]));</span><span class="w"></span>
<span class="w">                </span>simpleStorage<span class="p">.</span>store<span class="p">(</span>_simpleStorageNumber<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">sfRetrieve</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">_simpleStorageIndex</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span>SimpleStorage<span class="w"> </span>simpleStorage<span class="w"> </span><span class="o">=</span><span class="w"> </span>SimpleStorage<span class="p">(</span><span class="kt">address</span><span class="p">(</span>simpleStorageArray<span class="p">[</span>_simpleStorageIndex<span class="p">]));</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span>simpleStorage<span class="p">.</span>retrieve<span class="p">();</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>That was all for the storage example.</strong></p></li>
</ul>
</section>
</section>
<section id="fund-me">
<h2>Fund Me<a class="headerlink" href="#fund-me" title="Permalink to this headline"></a></h2>
<section id="a-simple-function-to-fund-your-smart-contract">
<h3>A simple function to fund your smart contract<a class="headerlink" href="#a-simple-function-to-fund-your-smart-contract" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>In case we want to create payable functions, we should use the keyword <code class="docutils literal notranslate"><span class="pre">payable</span></code>.</p></li>
<li><p>The code below is a simple implementation of a payable function.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-Licence-Identifier: MIT</span>

<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Let’s say for example that we want to keep track of who sent us funding using this contract: To do so, we can create a mapping between adresses and value.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-Licence-Identifier: MIT</span>

<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>adressToAmountFunded<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="c1">// msg.sender is the sender of the function call.</span>
<span class="w">                </span><span class="c1">// msg.value is how much they sent.</span>
<span class="w">            </span><span class="c1">// += to cumulate the amounts sent</span>
<span class="w">            </span>adressToAmountFunded<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="getting-external-data-with-chainlink">
<h3>Getting external data with chainlink<a class="headerlink" href="#getting-external-data-with-chainlink" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Blockchains being deterministic systems, we may encounter a slight problem. Let’s say that we want for example to receive our funds in USDT or any other currency instead of Ether. What we need is a conversion rate between Ether and this whatever currency. However, blockchains by themselves cannot interact with the real world and this is where oracles come into place.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Smart contracts are unable to connect with external systems, data feeds, APIs, existing payment systems or any other off-chain ressources on their own and cannot do external computations which makes them deterministic systems (wall garded).</p></li>
</ul>
</div>
<ul class="simple">
<li><p>There are two types of oracles, centralized oracles and decentralized oracles (like chainlink). If we count on centralized oracles to provide us with necessary data (like currency conversion rates), we will be going to ruin all the decentrality as if this centralized entity decides to stop feeding the smart contract with data, then, all our work will go to waste. The purpose of blockchain is that not a single entity can restict our freedom to interact with each other.</p></li>
</ul>
<ul class="simple">
<li><p>CHAINLINK is a modular oracle network that allows us to get data and do external computation in a highly sybil-resistant decentralized manner.</p></li>
<li><p>Let’s <strong>Get the latest price feed</strong>. We can use chainlink’s <code class="docutils literal notranslate"><span class="pre">get</span> <span class="pre">latest</span> <span class="pre">price</span> <span class="pre">feed</span></code> contract (<a class="reference external" href="https://docs.chain.link/docs/get-the-latest-price/">Get latest price</a>).</p></li>
<li><p>There is a Remix button that takes us directly to REMIX IDE.</p></li>
<li><p>When following the previous link, we get to see a foler created in REMIX with the following code and other things as well:</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.7</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">PriceConsumerV3</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>AggregatorV3Interface<span class="w"> </span><span class="kt">internal</span><span class="w"> </span>priceFeed<span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * Network: Kovan</span>
<span class="cm">         * Aggregator: ETH/USD</span>
<span class="cm">         * Address: 0x9326BFA02ADD2366b30bacB125260Af641031331</span>
<span class="cm">         */</span><span class="w"></span>
<span class="w">        </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x9326BFA02ADD2366b30bacB125260Af641031331</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="cm">/**</span>
<span class="cm">         * Returns the latest price</span>
<span class="cm">         */</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getLatestPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="w"></span>
<span class="w">                </span><span class="cm">/*uint80 roundID*/</span><span class="p">,</span><span class="w"> </span><span class="c1">// Defines how many times this price was updated</span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="nv">price</span><span class="p">,</span><span class="w"> </span><span class="c1">// The actual conversion rate</span>
<span class="w">                </span><span class="cm">/*uint startedAt*/</span><span class="p">,</span><span class="w"> </span><span class="c1">// Defines where this was last updated</span>
<span class="w">                </span><span class="cm">/*uint timeStamp*/</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="cm">/*uint80 answeredInRound*/</span><span class="w"></span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span>price<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul>
<li><p>As we can see, this contract requires a kovan faucet so in REMIX IDE, we should switch to injected web3 in order to use this contract and we should make sure that our connected wallet from metamask is a kovan testnet wallet.</p></li>
<li><p>Once we deploy this, we can have live conversion rates through <code class="docutils literal notranslate"><span class="pre">get_latest_price</span></code> function of this contract.</p></li>
<li><p>The reason why we cannot use a local network (simulated VM) and we use testnets is that, in a testnet, there is a network of nodes looking at this testnet and delivering data onto this testnet unlike in a simulated VM where there are no nodes. (However, we should note that there are ways to mock these interactions and mock a chainlink node returning data onto our blockchain.)</p></li>
<li><p><strong>In order to incorporate this ethusd conversion rate datafeed into our code</strong>, we have to import the chainlink <strong>eth-usd</strong> datafeed from the npm package <code class="docutils literal notranslate"><span class="pre">&#64;chainlink/contracts</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Syntaxe:      <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;&#64;chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface&quot;</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>As we can see, the imported is actually an interfaceand not a contract. To learn about interfaces, we will copy paste the interface code <code class="docutils literal notranslate"><span class="pre">AggregatorV3Interface.sol</span></code> from the github repository rather than simply importing it in a one line of code.</p></li>
</ul>
</section>
</section>
<section id="working-with-interfaces">
<h2>Working with interfaces<a class="headerlink" href="#working-with-interfaces" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>The following is an example of an interface, this is <code class="docutils literal notranslate"><span class="pre">AggregatorV3Interface.sol</span></code> interface.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

interface<span class="w"> </span>AggregatorV3Interface<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">decimals</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">description</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">version</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// getRoundData and latestRoundData should both raise &quot;No data present&quot;</span>
<span class="w">  </span><span class="c1">// if they do not have data to report, instead of returning unset values</span>
<span class="w">  </span><span class="c1">// which could be misinterpreted as actual reported values.</span>
<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">getRoundData</span><span class="p">(</span><span class="kt">uint80</span><span class="w"> </span><span class="nv">_roundId</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">roundId</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">startedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">updatedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">answeredInRound</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="kt">function</span><span class="w"> </span><span class="nv">latestRoundData</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">roundId</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">startedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">updatedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">answeredInRound</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>An interface starts with <code class="docutils literal notranslate"><span class="pre">interface</span></code> keyword rather than <code class="docutils literal notranslate"><span class="pre">contract</span></code>.</p></li>
<li><p>They are a minimalistic view into another contract and have function declarations and their return types only. They are similar to header files in C.</p></li>
<li><p>Interfaces generally contains empty “external” functions that we can call from another contract.</p></li>
<li><p>Solidity doesn’t natively understands how to interact with another contract. We have to tell Solidity what functions can be called on another contract.</p></li>
<li><p>Interface compile down to ABI (Application binary interface). The ABI tells solidity what functions can be called on another contract.</p></li>
<li><p>Anytime we need to interact with an <strong>already deployed contract</strong>, we need that contract’s ABI to do so.</p></li>
</ul>
</div>
<ul class="simple">
<li><p>In the following example, we’re going to interact, from a contract, with the previously defined interface.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

interface<span class="w"> </span>AggregatorV3Interface<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">decimals</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">description</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="nv">memory</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">version</span><span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// getRoundData and latestRoundData should both raise &quot;No data present&quot;</span>
<span class="w">        </span><span class="c1">// if they do not have data to report, instead of returning unset values</span>
<span class="w">        </span><span class="c1">// which could be misinterpreted as actual reported values.</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getRoundData</span><span class="p">(</span><span class="kt">uint80</span><span class="w"> </span><span class="nv">_roundId</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">roundId</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">startedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">updatedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">answeredInRound</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">latestRoundData</span><span class="p">()</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>view<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">roundId</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,</span><span class="w"> </span><span class="c1">// latest price</span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">startedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">updatedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">answeredInRound</span><span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>


<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>addressToAmountFunded<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>addressToAmountFunded<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Calling &quot;version&quot; function &quot;referenced ?&quot; in the</span>
<span class="w">        </span><span class="c1">// interface (and hence already alive in a deployed smart</span>
<span class="w">        </span><span class="c1">// contract that is going to provide us with the eth/usd</span>
<span class="w">        </span><span class="c1">// conversion rate) inside the contract.</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getVersion</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Same as arrays, structs etc: ...</span>
<span class="w">            </span><span class="c1">// It&#39;s like defining a type</span>
<span class="w">            </span><span class="c1">// public isn&#39;t necessary here as we already are in</span>
<span class="w">            </span><span class="c1">// a public function</span>
<span class="w">            </span><span class="c1">// We&#39;re gonna use rinkeby testnet in this example</span>
<span class="w">            </span><span class="c1">// the address that we&#39;re going to pass to AggregatorV3Interface</span>
<span class="w">            </span><span class="c1">// is a rinkeby testnet eth/usd pricefeed address</span>
<span class="w">                </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="kt">return</span><span class="w"> </span>priceFeed<span class="p">.</span>version<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// Let&#39;s create now a function called getPrice to get the latest price</span>
<span class="w">        </span><span class="c1">// of ETH in usd, that is the eth/usd conversion rate.</span>
<span class="w">        </span><span class="c1">// This time, the latestRoundData function returns a tuple (See the note</span>
<span class="w">        </span><span class="c1">// below the code snippet)</span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">roundId</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">startedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">updatedAt</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint80</span><span class="w"> </span><span class="nv">answeredInRound</span><span class="w"></span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>

<span class="w">            </span><span class="c1">// Since answer is int256, we will do a typecasting to get over the</span>
<span class="w">            </span><span class="c1">// compiling error saying that we cannot return uint256 since</span>
<span class="w">            </span><span class="c1">// answer is int256</span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="p">);</span><span class="w"></span>

<span class="w">            </span><span class="cm">/* Note: there are alot of unused variables (roundId etc....) which causes</span>
<span class="cm">            compiling errors... In order to be able to compile correctly, one has to</span>
<span class="cm">            use a slighlty different syntax, namely, we can simply return blanks for</span>
<span class="cm">            each unused variable:</span>
<span class="cm">            (,int256 answer,,,) = priceFeed.latestRoundData();</span>
<span class="cm">            */</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>A tuple is, in solidity, a list of objects that are potentially of different types. To define tuples, we use brackets.</p></li>
</ul>
</div>
<ul class="simple">
<li><p>To wrap this up, and since we learned now how to deal with interfaces, we can clean our code a bit to look much nicer by simply importing the AggregatorV3Interface from chainlink npm package and ignoring the unused vars in the latestRoundData() method. The code will look like this:</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="matching-units">
<h2>Matching units<a class="headerlink" href="#matching-units" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>When we work with smart contracts, we generally encounter some issues regarding the units when we do some conversions. That being said, it’s preferable to work with units of ether like <strong>Wei</strong> and <strong>Gwei</strong>. In the last contract for example, we may want to multiply our answer by a power of 10 so that we make sure to always have 18 decimal places. (4,5454,4554 -&gt; 4,5454,4554 * 1,0000,0000,00 = 4,5454,4554,0000,0000,00 =&gt; (18 decimal places) which is 4.5 ether in wei (divide by 10^18 and you’ll get it)).</p></li>
<li><p>Let’s define a <code class="docutils literal notranslate"><span class="pre">getConversionRate()</span></code> function.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.8.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// get Eth price:</span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Convert **without forgetting to match all units</span>
<span class="w">            </span><span class="c1">// with wei [ Divide by 10^18 (10^8 from</span>
<span class="w">            </span><span class="c1">// ethAmount and 10^10 from ethPrice) ]**</span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>Solidity has a pitfall when it comes to maths. For example, a uint8 has as maximum 255, if we define a uint8 that is equal to 255 + 1, Solidity will wrap around once we reach the maximum cap, so we get: 255 + 1 = 0, 255 + 55 = 54 and so on… which is actually wrong. This is what we call overflow in solidity and we should really be careful with it.</p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>There is a library in chainlink called <strong>SafeMathChainlink.sol</strong> that implements some math operations to be used to render warning messages when we encounter overflows. It should be used very often. However, Starting from Solidity v0.8, we no longer need SafeMath packages.</p></li>
</ul>
</div>
<ul class="simple">
<li><p>In the example below, we use Chainlink’s SafeMath library for uint256 varibale types only:</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The directive <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B</span></code> can be used to attach library functions (from the library A) to any type (B) in the context of a contract.</p></li>
</ul>
</div>
</section>
<section id="thresholding">
<h2>Thresholding<a class="headerlink" href="#thresholding" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Let’s set a threshold to the amount of Eth the sender sends us through this contract.</p></li>
<li><dl class="simple">
<dt>In order to do so, we have 2 options;</dt><dd><ul>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">require</span></code> keyword which is highly recommended: <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(getConversionRate(msg.value)</span> <span class="pre">&lt;</span> <span class="pre">minUSD)</span> <span class="pre">{</span> <span class="pre">revert?</span> <span class="pre">};</span></code></p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">-</span> <span class="pre">revert</span></code>:  <code class="docutils literal notranslate"><span class="pre">require(getConversionRate(msg.value)</span> <span class="pre">&gt;=</span> <span class="pre">minUSD);</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>These 2 lines are equivalent, they both stop the contract from executing if the requirement isn’t satisfied and revert the transaction =&gt; The user is going to receive his money back as well as any unspent gas.</p></li>
<li><p>We can add a revert error message: <code class="docutils literal notranslate"><span class="pre">require(getConversionRate(msg.value)</span> <span class="pre">&gt;=</span> <span class="pre">minUSD,</span> <span class="pre">&quot;You</span> <span class="pre">need</span> <span class="pre">to</span> <span class="pre">spend</span> <span class="pre">more</span> <span class="pre">ETH</span> <span class="pre">!&quot;);</span></code></p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>getConversionRate<span class="p">(</span><span class="k">msg.value</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>minUSD<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You need to spend at least 50 dollars in ETH !&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul>
<li><p>We can also add a function to withdraw the funds which is also a <code class="docutils literal notranslate"><span class="pre">payable</span></code> function. The keywords and functions that we are going to need are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">transfer()</span></code>: a method to transfer funds between two addresses.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">this</span></code> to refer to the current contract.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">balance</span></code> attribute to see the balance in ether of a contract. (In this example, we are going to withdraw all of the contract’s funds hence the <code class="docutils literal notranslate"><span class="pre">balance</span></code> attribute.)</p></li>
<li><p>Putting everything together: <code class="docutils literal notranslate"><span class="pre">msg.sender.transfer(address(this).balance)</span></code>– This line of code means; <strong>whoever is calling the withdraw method (which is msg.sender), transfer them all of the contract’s code.</strong></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>getConversionRate<span class="p">(</span><span class="k">msg.value</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>minUSD<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You need to spend at least 50 dollars in ETH !&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="ownership">
<h2>Ownership<a class="headerlink" href="#ownership" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>It is a <strong>very bad idea</strong> to define a contract with a public withdrawal function. Only the owner should be able to withdraw funds from a smart contract. We hence have to declare an “owner”.</p></li>
<li><p>In order to declare an owner to this smart contract, we maybe have to create a <code class="docutils literal notranslate"><span class="pre">createOwner</span></code> function to do the trick for us. However, this function can be called once the contract is deployed, so, if someone calls this function before we do once it is deployed, we are no longer the owners. Therefore, we need some sort of function that executes once the contract is deployed, and that’s what a <code class="docutils literal notranslate"><span class="pre">contructor</span></code> is ! It is what constructs the smart contruct.</p></li>
<li><p>We can hence, declare a variable called <code class="docutils literal notranslate"><span class="pre">owner</span></code>, and use the constructor to define the owner to be us, thus, <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> as <strong>the first</strong> <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> is whoever deployed the contract which in this case is us.</p></li>
<li><p>Once we define the owner, we can set a requirement through <code class="docutils literal notranslate"><span class="pre">require()</span></code> in the withdraw function.</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>getConversionRate<span class="p">(</span><span class="k">msg.value</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>minUSD<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You need to spend at least 50 dollars in ETH !&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="modifiers-and-resetting">
<h2>Modifiers and resetting<a class="headerlink" href="#modifiers-and-resetting" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Let’s say we have many contracts to be run and many functions that are only for the owner to use. Do we have to repeat this require statement each time ? The answer is no, but instead we can use a <code class="docutils literal notranslate"><span class="pre">modifier</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>A modifier is used to change the behavior of a function in a declarative way.</p></li>
</ul>
</div>
<ul class="simple">
<li><p>In the example below, we are going to modify our last code to use a modifier:</p></li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>getConversionRate<span class="p">(</span><span class="k">msg.value</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>minUSD<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You need to spend at least 50 dollars in ETH !&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="o">-</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>

<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The code says; before you run the withdraw function, do the <strong>onlyOwner</strong> statement first, and then, wherever you have <code class="docutils literal notranslate"><span class="pre">-;</span></code> in the <code class="docutils literal notranslate"><span class="pre">modifer</span></code> you can run the rest of the code.</p></li>
</ul>
</div>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>getConversionRate<span class="p">(</span><span class="k">msg.value</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>minUSD<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You need to spend at least 50 dollars in ETH !&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">                </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul>
<li><p>One thing that is missing in this contract is the balance <strong>resetting</strong>. When we withdraw funds from this contract, we should also update the funders’ sent amounts. For that;</p>
<blockquote>
<div><ul class="simple">
<li><p>We first create an array of addresses (called funders for example) to keep track of which addresses funded the smart contract.</p></li>
<li><p>When we withdraw the funds that are in the smart contract (defined by its address) to the owner’s wallet (defined by the address passed to the constructor which is also the first address in the funders array), we must reset all the “balances” to zero. To achieve this, we have to loop over all the addresses in the funders array and set their balances to zero.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: MIT</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.6.0</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/interfaces/AggregatorV3Interface.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="kt">import</span><span class="w"> </span><span class="s2">&quot;@chainlink/contracts/src/v0.6/vendor/SafeMathChainlink.sol&quot;</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">FundMe</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">        </span>using<span class="w"> </span>SafeMathChainlink<span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="kt">uint256</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>amountToaddress<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="p">[]</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>funders<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="k">public </span><span class="nv">owner</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>owner<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">msg.sender</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">fund</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">minUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10</span><span class="o">**</span><span class="m m-Decimal">18</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="kt">require</span><span class="p">(</span>getConversionRate<span class="p">(</span><span class="k">msg.value</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span>minUSD<span class="p">,</span><span class="w"> </span><span class="s2">&quot;You need to spend at least 50 dollars in ETH !&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span>amountToaddress<span class="p">[</span><span class="k">msg.sender</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">msg.value</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>funders<span class="p">.</span>push<span class="p">(</span><span class="k">msg.sender</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getPrice</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>AggregatorV3Interface<span class="w"> </span>priceFeed<span class="w"> </span><span class="o">=</span><span class="w"> </span>AggregatorV3Interface<span class="p">(</span><span class="mh">0x8A753747A1Fa494EC906cE90E9f37563A8AF630e</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">(,</span><span class="kt">int256</span><span class="w"> </span><span class="nv">answer</span><span class="p">,,,)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>priceFeed<span class="p">.</span>latestRoundData<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span>answer<span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m m-Decimal">10000000000</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">getConversionRate</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmount</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>getPrice<span class="p">();</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">ethAmountToUSD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>ethPrice<span class="o">*</span>ethAmount<span class="p">)</span><span class="o">/</span><span class="m m-Decimal">1000000000000000000</span><span class="p">;</span><span class="w"></span>

<span class="w">            </span><span class="kt">return</span><span class="w"> </span>ethAmountToUSD<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>


<span class="w">        </span><span class="kt">modifier</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">require</span><span class="p">(</span><span class="k">msg.sender</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>owner<span class="p">);</span><span class="w"></span>
<span class="w">                </span>_<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="kt">function</span><span class="w"> </span><span class="nv">withdraw</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>onlyOwner<span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">.</span>transfer<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">).</span>balance<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">for</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">fundersIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"> </span>fundersIndex<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span>funders<span class="p">.</span>length<span class="p">;</span><span class="w"> </span>fundersIndex<span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">funder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>funders<span class="p">[</span>fundersIndex<span class="p">];</span><span class="w"></span>
<span class="w">        </span>amountToaddress<span class="p">[</span>funder<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span>funders<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">address</span><span class="p">[](</span><span class="m m-Decimal">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// reset the funders array to an empty array of addresses</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Mouloud Bahae eddine.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>